<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WHEEL</title>
    <link rel="icon" type="image/png" href="https://github.com/ellandeperez/MHBestiary/blob/main/MHImages/0_Icons/question.png?raw=true">
    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&display=swap"
      rel="stylesheet"
    />
  </head>
  <style>
    @font-face {
        font-family: 'Albertus MT Std Regular';
        font-style: normal;
        font-weight: normal;
        src: local('Albertus MT Std Regular'), 
            url('fonts/FuenteMH.woff') format('woff');
        font-display: swap;
    }
    * {
    padding: 0;
    margin: 0;
    box-sizing: border-box;
    font-family: "Poppins", sans-serif;
    }
    body {
    height: 100vh;
    background-image: url('https://github.com/ellandeperez/MHBestiary/blob/main/MHImages/background.jpg?raw=true');
    background-size: cover;
    background-repeat: repeat;
    }
    .wrapper {
    width: 100%;
    max-width: 42em;
    max-height: 90vh;
    position: absolute;
    transform: translate(-50%, -50%);
    top: 50%;
    left: 50%;
    padding: 3em;
    border-radius: 1em;
    }
    .container {
    position: relative;
    width: 100%;
    height: 100%;
    }
    #wheel {
    max-height: inherit;
    width: inherit;
    top: 0;
    padding: 0;
    }
    @keyframes rotate {
    100% {
        transform: rotate(360deg);
    }
    }
    #spin-btn {
    position: absolute;
    transform: translate(-50%, -50%);
    top: 50%;
    left: 50%;
    height: 18%;
    width: 18%;
    border-radius: 50%;
    cursor: pointer;
    border: 0;
    background: radial-gradient(#e28c46 50%, #331c07 85%);
    color: #000000;
    text-transform: uppercase;
    font-size: 1.6em;
    letter-spacing: 0.1em;
    font-weight: 600;
    border: #000000 10px outset;
    }
    img {
    position: absolute;
    width: 4em;
    top: 45%;
    right: -8%;
    }
    #final-value {
    font-size: 1.5em;
    text-align: center;
    margin-top: 1.5em;
    color: #202020;
    font-weight: 500;
    }
    @media screen and (max-width: 768px) {
    .wrapper {
        font-size: 12px;
        padding: 1em;
        max-height: 95vh;
    }
    
    img.arrow {
        right: -15%;
    }

    h1 {
        font-size: 1.5em;
        margin-bottom: 20px;
    }

    #spin-btn {
        font-size: 1.8em;
    }

    /* Estilos responsivos para el modal */
    .modal-content {
        width: 90%;
        max-width: 300px;
        margin: 5% auto;
        padding: 15px;
    }

    .modal-image {
        width: 150px;
        height: 150px;
    }

    #modalMonsterName {
        font-size: 20px !important;
    }

    /* Ajustar el tamaño del texto en la ruleta */
    .chartjs-plugin-datalabels {
        font-size: 12px !important;
    }
    }
    @media screen and (max-width: 480px) {
    .wrapper {
        padding: 0.5em;
    }

    #spin-btn {
        font-size: 1em;
    }

    .modal-image {
        width: 120px;
        height: 120px;
    }
    }
    .nav-button {
      position: fixed;
      top: 20px;
      left: 20px;
      width: 60px;
      height: 60px;
      background-color: #995a29;
      border: 2px solid #2e1a0b;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: transform 0.2s;
      z-index: 1000;
    }

    .nav-button:hover {
      transform: scale(1.1);
      background-color: #b0805b;
    }

    .nav-button img {
      width: 40px;
      height: 40px;
      position: static;
    }

    /* Estilos para el modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
    }

    .modal-content {
      background-color: #995a29;
      border: 4px solid #2e1a0b;
      margin: 15% auto;
      padding: 20px;
      width: 300px;
      border-radius: 15px;
      text-align: center;
    }

    .modal-image {
      width: 200px;
      height: 200px;
      margin: 10px auto;
      display: block;
    }

    .close-modal {
      color: #2e1a0b;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close-modal:hover {
      color: #000;
    }

    /* Eliminar los estilos antiguos de la imagen flecha y añadir los nuevos del indicador */
    .wheel-indicator {
        position: absolute;
        right: -20px;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-left: 20px solid #2e1a0b;
        border-top: 20px solid transparent;
        border-bottom: 20px solid transparent;
        filter: drop-shadow(0 0 2px rgba(0,0,0,0.5));
    }

    /* Añadir un círculo decorativo en la base del triángulo */
    .wheel-indicator::after {
        content: '';
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        width: 12px;
        height: 12px;
        background: #995a29;
        border: 2px solid #2e1a0b;
        border-radius: 50%;
    }

    @media screen and (max-width: 768px) {
        .wheel-indicator {
            right: -15px;
            border-left-width: 15px;
            border-top-width: 15px;
            border-bottom-width: 15px;
        }

        .wheel-indicator::after {
            right: 12px;
            width: 8px;
            height: 8px;
        }
    }

    /* Añadir estilos para el header */
    .header-container {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        position: relative;
        gap: 20px;
    }

    .header-title {
        text-align: center;
        font-family: 'Albertus MT Std Regular';
        color: #000000;
        text-shadow: 0px 0px 20px #ffb35d;
        margin: 0;
    }

    .nav-button {
        position: static; /* Cambiar de fixed a static */
        margin-left: 20px;
    }

    @media screen and (max-width: 768px) {
        .header-container {
            padding: 10px;
            gap: 10px;
        }

        .header-title {
            font-size: 1.5em;
        }

        .nav-button {
            width: 50px;
            height: 50px;
        }
    }

    /* Sidebar styles */
    #sidebar {
        position: fixed;
        left: -264px;
        height: 100vh;
        top: 0px;
        width: 264px;
        background-color: rgba(255, 255, 255, 0.5);
        backdrop-filter: blur(50px);
        box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        transition: left 0.3s ease;
        z-index: 1000;
        display: flex;
        flex-direction: column;
    }

    #sidebar .sidebar-header {
        position: sticky;
        top: 175px;
        padding: 1rem;
        z-index: 2;
    }

    #sidebar .sidebar-content {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        padding-top: 20px;
        padding-bottom: 140px;
    }

    #sidebar .sidebar-content::-webkit-scrollbar {
        width: 6px;
    }

    #sidebar .sidebar-content::-webkit-scrollbar-track {
        background: transparent;
    }

    #sidebar .sidebar-content::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 3px;
    }

    #sidebar .toggle-sidebar-button {
        position: absolute;
        right: -40px;
        top: 10%;
        transform: translateY(-50%);
        width: 40px;
        height: 60px;
        background-color: rgba(255, 255, 255, 0.5);
        backdrop-filter: blur(50px);
        border-radius: 0 8px 8px 0;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .dark #sidebar .toggle-sidebar-button {
        background-color: rgba(42, 44, 48, 0.95);
    }

    #sidebar .toggle-sidebar-button:hover {
        background-color: rgba(255, 255, 255, 0.7);
    }

    .dark #sidebar .toggle-sidebar-button:hover {
        background-color: rgba(70, 73, 78, 0.95);
    }

    .dark #sidebar {
        background-color: rgba(40, 42, 43, 0.95);
    }

    #sidebar a {
        font-family:'Albertus MT Std Regular';
        display: flex;
        align-items: center;
        gap: 12px; /* Espacio consistente entre imagen y texto */
        padding: 0.75rem;
        border-radius: 0.5rem;
        transition: all 0.2s ease;
        backdrop-filter: blur(5px);
        text-decoration: none;
        color: black;
        min-height: 60px; /* Altura mínima para mantener consistencia */
    }

    .dark #sidebar a {
        display: flex;
        align-items: center;
        padding: 0.75rem;
        border-radius: 0.5rem;
        transition: all 0.2s ease;
        background-color: rgba(81, 86, 90, 0.95);
    }

    #sidebar a:hover {
        transform: translateX(4px);
    }

    #sidebar img {
        transition: transform 0.2s ease;
        width: 35px;
        height: 35px;
        object-fit: contain; /* Mantiene la proporción de la imagen */
        position: static; /* Anula la posición absolute que pueda heredar */
        flex-shrink: 0; /* Evita que la imagen se encoja */
    }

    #sidebar a:hover img {
        transform: scale(1.1);
    }

    .botonDark{
        border: none;
        background-color: #939aa8;
        transition: background-color 0.2s ease;
    }
    .botonDark:hover{
        background-color: #666a74;
    }

    /* Utility classes for sidebar */
    .px-1\.5 { padding-left: 0.375rem; padding-right: 0.375rem; }
    .py-1\.5 { padding-top: 0.375rem; padding-bottom: 0.375rem; }
    .rounded-lg { border-radius: 0.5rem; }
    .transition-colors { transition-property: background-color, border-color, color, fill, stroke; }
    .p-3 { padding: 0.75rem; }
    .gap-3 { gap: 0.75rem; }
    .w-8 { width: 2rem; }
    .h-8 { height: 2rem; }
    .h-6 { height: 1.5rem; }
    .w-6 { width: 1.5rem; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .space-y-4 > * + * { margin-top: 1rem; }
    .gap-2 { gap: 0.5rem; }
    .flex { display: flex; }

    #sidebar .sidebar-content span {
    font-family: 'Albertus MT Std Regular', sans-serif !important;
    color: inherit;
}
  </style>
  <body>
    <!-- Add sidebar -->
    <div id="sidebar" class="fixed -left-64 h-full w-64 shadow-lg transition-all duration-300 z-40">
        <div class="toggle-sidebar-button" onclick="toggleSidebar()">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
            </svg>
        </div>
        <div class="sidebar-content">
            <div class="space-y-4">  
                <div class="flex items-center justify-between gap-2">
                    <button 
                        onclick="window.location.href='https://ellandeperez.github.io/MHBestiary/'"
                        class="botonDark px-1.5 py-1.5 rounded-lg transition-colors">
                        <img style="width:35px;height:35px;" src="https://github.com/ellandeperez/MHBestiary/blob/main/MHImages/0_Icons/home.png?raw=true" class="h-6 w-6" alt="Alternar Modo Oscuro">
                    </button>                     
                </div>
                <a href="https://ellandeperez.github.io/MHBestiary/menu.html" 
                class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <img src="https://github.com/ellandeperez/MHBestiary/blob/main/MHImages/0_Icons/bbq.png?raw=true" 
                        class="w-8 h-8" alt="Menu">
                    <span>Menú Wilds</span>
                </a>
                <a href="https://ellandeperez.github.io/MHBestiary/galeria.html" 
                class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <img src="https://github.com/ellandeperez/MHBestiary/blob/main/MHImages/0_Icons/map.png?raw=true" 
                        class="w-8 h-8" alt="Menu">
                    <span>Galeria</span>
                </a>
                <a href="https://ellandeperez.github.io/MHBestiary/wheel.html" 
                   class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <img src="https://github.com/ellandeperez/MHBestiary/blob/main/MHImages/0_Icons/question.png?raw=true" 
                         class="w-8 h-8" alt="Ruleta">
                    <span>Ruleta de Monstruos</span>
                </a>
                <a href="https://ellandeperez.github.io/MHBestiary/GeneraMonstruos.html" 
                   class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <img src="https://github.com/ellandeperez/MHBestiary/blob/main/MHImages/0_Icons/book_blue.png?raw=true" 
                         class="w-8 h-8" alt="Ruleta">
                    <span>Generar Monstruos</span>
                </a>
            </div>
        </div>
    </div>

    <div class="header-container">
        <h1 class="header-title">MH WILDS ROULETTE</h1>
    </div>

    <div class="wrapper">
      <div class="container">
        <canvas id="wheel"></canvas>
        <button style="font-family:'Albertus MT Std Regular';font-weight: bold;" id="spin-btn">Spin</button>
        <div class="wheel-indicator"></div>
      </div>
      <div id="final-value" >
        <p style="font-family:'Albertus MT Std Regular';font-weight: bold;">¡GIRA!</p>
      </div>
    </div>
    
    <!-- Añadir el modal -->
    <div id="monsterModal" class="modal">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2 id="modalMonsterName" style="font-family:'Albertus MT Std Regular';color:#2e1a0b;"></h2>
        <img style="position: relative;right:-5%;" id="modalMonsterImage" class="modal-image" src="" alt="Monster">
      </div>
    </div>

    <!-- Chart JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- Chart JS Plugin for displaying text over chart -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.1.0/chartjs-plugin-datalabels.min.js"></script>
  </body>
  <script>
    const wheel = document.getElementById("wheel");
    const spinBtn = document.getElementById("spin-btn");
    const finalValue = document.getElementById("final-value");

    const monsters = [
        'Ajarakan', 'Arkveld', 'Balahara', 'Blangonga', 'Chatacabra',
        'Congalala', 'Doshaguma', 'G. Anjanath F', 'G. Arkveld', 'G. Doshaguma',
        'G. Odogaron E', 'G. Rathalos', 'Gore Magala', 'Gravios', 'Gypceros',
        'Hirabami', 'Jin Dahaad', 'Lala Barina', 'Nerscylla', 'Nu Udra',
        'Quematrice', 'Rathalos', 'Rathian', 'Rey Dau', 'Rompopolo',
        'Uth Duna', 'Xu Wu', 'Yian Kut-Ku', 'Zoh Shia'
    ];

    // Crear un array con el mismo valor para cada sección
    const data = Array(monsters.length).fill(100/monsters.length);

    // Generar colores alternados
    const pieColors = monsters.map((_, index) => {
        return index % 2 === 0 ? '#b0805b' : '#995a29';
    });

    // Calcular los valores de rotación
    const rotationValues = monsters.map((_, index) => {
        const sectionSize = 360 / monsters.length;
        return {
            minDegree: index * sectionSize,
            maxDegree: (index + 1) * sectionSize,
            value: monsters[index]
        };
    });

    function updateChartFontSize() {
        const fontSize = window.innerWidth <= 768 ? 11: 18;
        if (myChart) {
            myChart.options.plugins.datalabels.font.size = fontSize;
            myChart.update();
        }
    }

    window.addEventListener('resize', updateChartFontSize);

    let myChart = new Chart(wheel, {
        plugins: [ChartDataLabels],
        type: "pie",
        data: {
            labels: monsters,
            datasets: [{
                backgroundColor: pieColors,
                borderColor:'#2e1a0b',
                data: data,
            }],
        },
        options: {
            responsive: true,
            animation: { duration: 0 },
            plugins: {
                tooltip: false,
                legend: {
                    display: false,
                },
                datalabels: {
                    color: "#ffffff",
                    formatter: (_, context) => context.chart.data.labels[context.dataIndex],
                    font: { 
                        size: window.innerWidth <= 768 ? 11 : 18,
                        weight: 'bold',
                        family: 'Albertus MT Std Regular'
                    },
                    align: 'end',
                    anchor: 'center',
                    offset: -10,
                    textStrokeColor: 'black',
                    textStrokeWidth: 4,
                    rotation: (context) => {
                        const angle = context.chart.options.rotation || 0;
                        const sectionAngle = (360 / monsters.length);
                        return (angle + (context.dataIndex * sectionAngle) + sectionAngle/2 + -90);
                    }
                },
            },
        },
    });

    const valueGenerator = (angleValue) => {
        // La flecha apunta a la derecha (0 grados), necesitamos ajustar el ángulo
        let normalizedAngle = (-angleValue + 90) % 360;
        if (normalizedAngle < 0) normalizedAngle += 360;
        
        const sectionSize = 360 / monsters.length;
        const index = Math.floor(normalizedAngle / sectionSize);
        const monster = monsters[index];
        
        finalValue.innerHTML = `<p style="font-family:'Albertus MT Std Regular';font-weight: bold;font-size:32px;">¡${monster}!</p>`;
        
        // Mostrar el modal con la imagen
        const modal = document.getElementById("monsterModal");
        const modalName = document.getElementById("modalMonsterName");
        const modalImage = document.getElementById("modalMonsterImage");
        
        modalName.textContent = monster;
        modalImage.src = `https://github.com/ellandeperez/MHBestiary/blob/main/MHImages/${monster}/Icon.png?raw=true`;
        modal.style.display = "block";
        
        spinBtn.disabled = false;
    };

    // Añadir el código para cerrar el modal
    const modal = document.getElementById("monsterModal");
    const closeBtn = document.getElementsByClassName("close-modal")[0];

    closeBtn.onclick = function() {
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    let count = 0;
    let resultValue = 101;

    spinBtn.addEventListener("click", () => {
        spinBtn.disabled = true;
        finalValue.innerHTML = `<p style="font-family:'Albertus MT Std Regular';font-weight: bold;font-size:32px;">¡Girando!</p>`;
        
        const sectionSize = 360 / monsters.length;
        const randomSection = Math.floor(Math.random() * monsters.length);
        const finalRotation = -((randomSection * sectionSize) + 90);
        let currentRotation = 0;
        let totalSpins = 0;
        let rotationSpeed = 10; // Velocidad inicial más controlada
        
        let rotationInterval = window.setInterval(() => {
            currentRotation -= rotationSpeed;
            
            // Normalizar la rotación actual
            if (currentRotation <= -360) {
                currentRotation = 0;
                totalSpins++;
                rotationSpeed = Math.max(3, rotationSpeed * 0.5); // Reducción gradual de velocidad
            }

            // Comprobar condición de parada
            if (totalSpins >= 3 && rotationSpeed <= 3) {
                currentRotation = finalRotation; // Forzar posición final exacta
                myChart.options.rotation = currentRotation;
                myChart.update();
                valueGenerator(currentRotation);
                clearInterval(rotationInterval);
                spinBtn.disabled = false;
                return;
            }
            
            myChart.options.rotation = currentRotation;
            myChart.update();
        }, 20); // Intervalo más largo para mejor rendimiento
    });

    // Add sidebar toggle function
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        if (sidebar.style.left === '0px') {
            sidebar.style.left = '-264px';
        } else {
            sidebar.style.left = '0px';
        }
    }
  </script>
</html>